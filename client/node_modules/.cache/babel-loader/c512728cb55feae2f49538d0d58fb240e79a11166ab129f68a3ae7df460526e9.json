{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\dinat\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\lining\\\\client\\\\src\\\\context\\\\CartContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useState, useContext, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CartContext = /*#__PURE__*/createContext();\nexport const CartProvider = ({\n  children\n}) => {\n  _s();\n  // Состояние пользователя\n  const getInitialuser = () => {\n    const saveduser = localStorage.getItem('user');\n    return saveduser ? JSON.parse(saveduser) : null;\n  };\n  const [user, setuser] = useState(getInitialuser);\n\n  // Состояние корзины\n  const [cartItems, setCartItems] = useState(() => {\n    const savedCart = localStorage.getItem('cartItems');\n    return savedCart ? JSON.parse(savedCart) : [];\n  });\n  const saveCartToLocalStorage = items => {\n    localStorage.setItem('cartItems', JSON.stringify(items));\n  };\n  const cartCount = cartItems.reduce((sum, item) => sum + item.quantity, 0);\n\n  // Функции корзины\n  const addToCart = product => {\n    // реализация аналогична вашей\n  };\n  const removeFromCart = cartId => {\n    // реализация аналогична вашей\n  };\n  const updateQuantity = (cartId, newQuantity) => {\n    // реализация аналогична вашей\n  };\n\n  // Авторизация\n  const isAuthenticated = () => {\n    return user !== null;\n  };\n  const fetchCurrentuser = async () => {\n    const token = localStorage.getItem('token');\n    if (!token) return null;\n    try {\n      const response = await fetch('http://localhost:5000/api/auth/me', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      if (!response.ok) {\n        logout();\n        return null;\n      }\n      const data = await response.json();\n      setuser(data.user);\n      return data.user;\n    } catch (error) {\n      console.error('Ошибка при получении пользователя:', error);\n      logout();\n      return null;\n    }\n  };\n  const login = async (email, password) => {\n    const response = await fetch('http://localhost:5000/api/auth/login', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        email,\n        password\n      })\n    });\n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.message || 'Неверный email или пароль');\n    }\n    const data = await response.json();\n    localStorage.setItem('token', data.token);\n    localStorage.setItem('user', JSON.stringify(data.user));\n    setuser(data.user);\n  };\n  const register = async (name, email, password) => {\n    const response = await fetch('http://localhost:5000/api/auth/register', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        name,\n        email,\n        password\n      })\n    });\n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.message || 'Ошибка регистрации');\n    }\n    const data = await response.json();\n    localStorage.setItem('token', data.token);\n    localStorage.setItem('user', JSON.stringify(data.user));\n    setuser(data.user);\n  };\n  const logout = () => {\n    setuser(null);\n    localStorage.removeItem('user');\n    localStorage.removeItem('token');\n    localStorage.removeItem('cartItems');\n  };\n  const isAdmin = () => {\n    return (user === null || user === void 0 ? void 0 : user.isAdmin) === true;\n  };\n\n  // Инициализация пользователя при загрузке\n  useEffect(() => {\n    const checkAuth = async () => {\n      await fetchCurrentuser();\n    };\n    checkAuth();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(CartContext.Provider, {\n    value: {\n      user,\n      login,\n      register,\n      logout,\n      isAdmin,\n      isAuthenticated,\n      fetchCurrentuser,\n      cartItems,\n      cartCount,\n      addToCart,\n      removeFromCart,\n      updateQuantity\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 129,\n    columnNumber: 5\n  }, this);\n};\n_s(CartProvider, \"P3QcFYOVB+Jy5NaY6dO1f6YM3P8=\");\n_c = CartProvider;\nexport const useCart = () => {\n  _s2();\n  return useContext(CartContext);\n};\n_s2(useCart, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"CartProvider\");","map":{"version":3,"names":["createContext","useState","useContext","useEffect","jsxDEV","_jsxDEV","CartContext","CartProvider","children","_s","getInitialuser","saveduser","localStorage","getItem","JSON","parse","user","setuser","cartItems","setCartItems","savedCart","saveCartToLocalStorage","items","setItem","stringify","cartCount","reduce","sum","item","quantity","addToCart","product","removeFromCart","cartId","updateQuantity","newQuantity","isAuthenticated","fetchCurrentuser","token","response","fetch","headers","ok","logout","data","json","error","console","login","email","password","method","body","errorData","Error","message","register","name","removeItem","isAdmin","checkAuth","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useCart","_s2","$RefreshReg$"],"sources":["C:/Users/dinat/OneDrive/Рабочий стол/lining/client/src/context/CartContext.js"],"sourcesContent":["import { createContext, useState, useContext, useEffect } from 'react';\r\n\r\nconst CartContext = createContext();\r\n\r\nexport const CartProvider = ({ children }) => {\r\n  // Состояние пользователя\r\n  const getInitialuser = () => {\r\n    const saveduser = localStorage.getItem('user');\r\n    return saveduser ? JSON.parse(saveduser) : null;\r\n  };\r\n\r\n  const [user, setuser] = useState(getInitialuser);\r\n\r\n  // Состояние корзины\r\n  const [cartItems, setCartItems] = useState(() => {\r\n    const savedCart = localStorage.getItem('cartItems');\r\n    return savedCart ? JSON.parse(savedCart) : [];\r\n  });\r\n\r\n  const saveCartToLocalStorage = (items) => {\r\n    localStorage.setItem('cartItems', JSON.stringify(items));\r\n  };\r\n\r\n  const cartCount = cartItems.reduce((sum, item) => sum + item.quantity, 0);\r\n\r\n  // Функции корзины\r\n  const addToCart = (product) => {\r\n    // реализация аналогична вашей\r\n  };\r\n\r\n  const removeFromCart = (cartId) => {\r\n    // реализация аналогична вашей\r\n  };\r\n\r\n  const updateQuantity = (cartId, newQuantity) => {\r\n    // реализация аналогична вашей\r\n  };\r\n\r\n  // Авторизация\r\n  const isAuthenticated = () => {\r\n    return user !== null;\r\n  };\r\n\r\n  const fetchCurrentuser = async () => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) return null;\r\n\r\n    try {\r\n      const response = await fetch('http://localhost:5000/api/auth/me', {\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        logout();\r\n        return null;\r\n      }\r\n\r\n      const data = await response.json();\r\n      setuser(data.user);\r\n      return data.user;\r\n    } catch (error) {\r\n      console.error('Ошибка при получении пользователя:', error);\r\n      logout();\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const login = async (email, password) => {\r\n    const response = await fetch('http://localhost:5000/api/auth/login', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ email, password })\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      throw new Error(errorData.message || 'Неверный email или пароль');\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    localStorage.setItem('token', data.token);\r\n    localStorage.setItem('user', JSON.stringify(data.user));\r\n    setuser(data.user);\r\n  };\r\n\r\n  const register = async (name, email, password) => {\r\n    const response = await fetch('http://localhost:5000/api/auth/register', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ name, email, password })\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      throw new Error(errorData.message || 'Ошибка регистрации');\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    localStorage.setItem('token', data.token);\r\n    localStorage.setItem('user', JSON.stringify(data.user));\r\n    setuser(data.user);\r\n  };\r\n\r\n  const logout = () => {\r\n    setuser(null);\r\n    localStorage.removeItem('user');\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('cartItems');\r\n  };\r\n\r\n  const isAdmin = () => {\r\n    return user?.isAdmin === true;\r\n  };\r\n\r\n  // Инициализация пользователя при загрузке\r\n  useEffect(() => {\r\n    const checkAuth = async () => {\r\n      await fetchCurrentuser();\r\n    };\r\n\r\n    checkAuth();\r\n  }, []);\r\n\r\n  return (\r\n    <CartContext.Provider\r\n      value={{\r\n        user,\r\n        login,\r\n        register,\r\n        logout,\r\n        isAdmin,\r\n        isAuthenticated,\r\n        fetchCurrentuser,\r\n        cartItems,\r\n        cartCount,\r\n        addToCart,\r\n        removeFromCart,\r\n        updateQuantity\r\n      }}\r\n    >\r\n      {children}\r\n    </CartContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useCart = () => useContext(CartContext);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}